#!/bin/bash -ue

echo "Release name:" "$@"

release_name=$@

# Check if the argument is a valid release name
if !([[ $release_name =~ ^v[0-9]*\.[0-9]*\.[0-9]*-?[a-z]*[0-9]*$ ]]); then
    echo "Ops! Something is wrong!
    ======== Valid names ========
    v1.0.0
    v1.2.3-beta10
    v103.034.15-beta1

    ======== Invalid names ========
    1.0.0
    v1.0
    v1.beta10"

    exit 1
fi

echo "Creating release..."

git commit -am "$release_name" || true
git tag "$release_name"
git push
git push origin "$release_name"

# Create GitHub Release
gh release create "$release_name" \
  --title "$release_name" \
  --notes "Release $release_name"

echo "***** DONE *****"
echo "Release published on GitHub:"
echo "https://github.com/utrustdev/utrust-for-woocommerce/releases/tag/$release_name"
